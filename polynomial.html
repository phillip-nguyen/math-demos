<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 95%; }
      #graphdiv {
	  width: 400px;
	  height: 400px;
	  position: relative;
	  margin: 0 auto;
      }
      .graph { 
	  width: 100%;
	  height: 100%;
	  border: 0px solid gray;
	  margin: 0px;
	  position: absolute;
	  left: 0;
	  top: 0;
      }
      #graph1 { z-index: 0; }
      #graph2 { z-index: 1; }
      .formula {
	  font: 40px serif;
      }
      .formula-div {
	  text-align: left;
	  margin-left: 50px;
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
	  -webkit-appearance: none;
	  margin: 0;
      }
      input{ 
	  color: #0000cc; 
	  border: 1px solid #ccc;
	  -webkit-appearance: none;
      }
      input:focus{ 
	  color: #0000cc; 
	  border: 1px solid #5ebaed;
	  box-shadow: 0 0 10px #5ebaed;
	  outline: none;
	  -webkit-appearance: none;
      }
      input[readonly] { 
	  outline: none;
	  border: 1px dashed #ccc;
	  -webkit-appearance: none;
      }
      input[readonly]:focus { 
	  outline: none;
	  border: 1px dashed #ccc;
	  box-shadow: none;
	  -webkit-appearance: none;
      }
      .input { 
	  font-size: 24px;
	  width: 75px;
	  text-align: center;
      }
      .smallinput { 
	  font-size: 14px;
	  width: 20px;
	  text-align: left;
      }
      .medinput { 
	  font-size: 24px;
	  width: 200px;
	  text-align: center;
      }
      .biginput { 
	  font-size: 24px;
	  width: 300px;
	  text-align: center;
      }
      .step {
	  font-size: 24px;
      }
      .check {
	  display: inline-block;
	  border-radius: 50%;
	  width: 32px;
	  height: 32px;
	  background-color: #00cc00;
	  color: #ffff00;
	  text-align: center;
	  font-size: 26px;
      }
      .cross {
	  display: inline-block;
	  border-radius: 50%;
	  width: 32px;
	  height: 32px;
	  background-color: #cc0000;
	  color: #ff9999;
	  text-align: center;
	  font-size: 26px;
      }
      #walkthrough li {
	  margin: 25px;
      }
    </style>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="calc.js"></script>
    <script src="math.js"></script>
    <script src="poly.js"></script>
    <script type="text/javascript">
      "use strict";
      // Copyright 2013 Phillip Nguyen.
      // All rights reserved.

      var the_polynomial;

      function randInt(min, max) {
	  return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function randSign() {
	  return (randInt(1,2) === 1 ? -1 : 1);
      }

      function solve_quadratic(a, b, c) {
	  var discr = b*b - 4*a*c;
	  if (discr < 0) return [];
	  if (discr === 0) return [-b/(2*a)];
	  var root = Math.sqrt(discr);
	  var zeros = [(-b+root)/(2*a), (-b-root)/(2*a)];
	  return zeros.sort(function(a,b) { return a-b; });
      }

      function random_poly3() {
	  // Get three distinct random zeros.
	  var z1, z2, z3;
	  z1 = randInt(-8,8);
	  do { z2 = randInt(-8,8); } while (z2 === z1);
	  do { z3 = randInt(-8,8); } while (z3 === z1 || z3 === z2);
	  // And set three random multiplicities (at most multiplicity 3).
	  var m1 = randInt(1,3);
	  var m2 = randInt(1,3);
	  var m3 = randInt(1,3);
	  
	  // Figure out where the (non-zero) extrema are.
	  // The derivative of the poly will have a factor that is
	  // quadratic having the following coefficients:
	  var da = m1 + m2 + m3;
	  var db = -(m1*(z2 + z3) + m2*(z1 + z3) + m3*(z1 + z2));
	  var dc = m1*z2*z3 + m2*z1*z3 + m3*z1*z2;
	  var critx = solve_quadratic(da, db, dc);
	  
	  var poly = { 
	      'a': [1, 1], 
	      'z1': z1, 'z2': z2, 'z3': z3,
	      'm1': m1, 'm2': m2, 'm3': m3, 
	      'critx': critx, 
	  };
	  poly.zeros = {};
	  poly.zeros[z1] = m1;
	  poly.zeros[z2] = m2;
	  poly.zeros[z3] = m3;

	  poly.base_eval = function(x) {
	      return Math.pow(x - z1, m1) * Math.pow(x - z2, m2) * Math.pow(x - z3, m3);
	  }
	  
	  poly.eval = function(x) {
	      return poly.a[0] * poly.base_eval(x) / poly.a[1];
	  }

	  // Find the coordinates of the local extrema having the
	  // y-coordinate with largest absolute magnitude.
	  var xmax, ymax;
	  for (var i = 0; i < critx.length; i++) {
	      var x = critx[i], absy = Math.abs(poly.eval(x));
	      if (ymax === undefined || absy > ymax) {
		  xmax = x;
		  ymax = absy;
	      }
	  }

	  // How do we pick an appropriate scaling factor for the polynomial
	  // so that everything fits into a [-10,10]x[-10,10] graphing window?
	  // Also would like to have a nice point with integer coordinates visible,
	  // preferably, the y-intercept.
	  var scale = randSign() * randInt(6,9) / ymax;
	  var intercept = Math.abs(scale*poly.base_eval(0));
	  if (intercept > 1 && intercept < 9) {
	      var nice_y = Math.round(scale*poly.base_eval(0));
	      poly.a = MATH.rat_simplify([nice_y, poly.base_eval(0)]);
	  } else {
	      var nice_x = Math.round(xmax);
	      if (nice_x === 0) { nice_x = 1; }
	      var nice_y = Math.round(scale*poly.base_eval(nice_x));
	      poly.a = MATH.rat_simplify([nice_y, poly.base_eval(nice_x)]);
	  }

	  poly.extrema = [];
	  for (var i = 0; i < critx.length; i++) {
	      var x = critx[i];
	      poly.extrema.push([x, poly.eval(x)]);
	  }
	  return poly;
      }

      function good_random_poly3() {
	  do {
	      var poly = random_poly3();
	      var oversquashed = false;
	      for (var i = 0; i < poly.extrema.length; i++) {
		  if (Math.abs(poly.extrema[i][1]) < 1) {
		      oversquashed = true;
		      break;
		  }
	      }
	  } while (oversquashed || isNaN(poly.a[0]) || poly.a[0] === 0 || poly.a[1] === 0 || poly.a[1] > 100);
	  return poly;
      }

      function init_canvas(name) {
	  var canvas = $(name)[0];
	  canvas.width = ""+$(name).width();
	  canvas.height = ""+$(name).height();
	  // Fix the coordinate system so that origin is in center of canvas
	  // with y-axis pointing up and x-axis pointing right.
	  var ctx = canvas.getContext("2d");
	  
	  var min_dimension = Math.min(canvas.width, canvas.height);
	  canvas.scale = min_dimension / 23;
	  
	  //ctx.setTransform(scale, 0, 0, -scale, min_dimension / 2, min_dimension / 2);
	  ctx.setTransform(canvas.scale, 0, 0, -canvas.scale, canvas.width/2, canvas.height/2);
	  ctx.lineWidth=1/canvas.scale;
      }

      function draw_grid() {
	  var canvas = $("#graph1")[0];
	  var ctx = canvas.getContext("2d");
	  var deg_to_rad = Math.PI/180.0;
	  var max_radius = 10;

	  ctx.beginPath();
	  ctx.strokeStyle="#cccccc";
	  // Grid lines
	  for (var i = -10; i <= 10; i++) {
	      ctx.moveTo(-10, i);
	      ctx.lineTo(10, i);
	      ctx.moveTo(i, -10);
	      ctx.lineTo(i, 10);
	  }
	  ctx.stroke();

	  // X and Y axes.
	  ctx.beginPath();
	  ctx.strokeStyle="black";
	  ctx.moveTo(-max_radius-.5, 0);
	  ctx.lineTo(max_radius+.5, 0);
	  ctx.moveTo(0, -max_radius-.5);
	  ctx.lineTo(0, max_radius+.5);
	  ctx.stroke();

	  ctx.save();
	  // X and Y axis labels
	  ctx.setTransform(1, 0, 0, 1, canvas.width/2, canvas.height/2);
	  ctx.font = "bold italic 18px Times New Roman";
	  ctx.textAlign = "center";
	  ctx.textBaseline = "middle";
	  ctx.fillText("x", 11.1*canvas.scale, -0.1*canvas.scale);
	  ctx.fillText("y", 0, -11.3*canvas.scale);
	  // tick mark labels
	  ctx.font = "10px sans-serif";
	  ctx.textBaseline = "middle";
	  for (var i = -10; i <= 10; i++) {
	      if (i === 0) continue;
	      ctx.fillText(i.toString(), i*canvas.scale, 0.5*canvas.scale);
	  }
	  ctx.textAlign = "right";
	  for (var i = -10; i <= 10; i++) {
	      if (i === 0) continue;
	      ctx.fillText(i.toString(), -0.2*canvas.scale, -i*canvas.scale);
	  }
	  ctx.restore();

      }

      function clear_graph() {
	  var canvas = $("#graph2")[0];
	  var ctx = canvas.getContext("2d");
	  ctx.save();
	  ctx.setTransform(1, 0, 0, 1, 0, 0);
	  ctx.clearRect(0, 0, canvas.width, canvas.height);
	  ctx.restore();
      }

      function graph_function() {
	  var canvas = $("#graph2")[0];
	  var ctx = canvas.getContext("2d");
	  var incr = canvas.width / 5000;
	  var x, y;
	  
	  ctx.strokeStyle="red";
	  ctx.lineWidth=2/canvas.scale;

	  var f = the_polynomial.eval;

	  // Determine bounds of graph.
	  var bounds = [-10,10];
	  if (bounds.length < 2) return;
	  var x1 = bounds[0];
	  var x2 = bounds[1];
	  if (x1 > 11) return;
	  if (x2 < -11) return;
	  if (x1 < -11) x1 = -11;
	  if (x2 > 11) x2 = 11;

	  // Stroke the function.
	  ctx.beginPath();
	  for (x = x1; x <= x2; x += incr) {
	      y = f(x);
	      ctx.lineTo(x, y);
	  }
	  y = f(x2);
	  ctx.lineTo(x2, y);
	  ctx.stroke();

	  // Mark points at integer coordinates.
	  ctx.fillStyle="red";
	  for (x = -10; x <= 10; x += 1) {
	      y = f(x);
	      if (Math.abs(y % 1) < 1e-10 && -10 <= y && y <= 10) {
		  ctx.beginPath();
		  ctx.arc(x, y, 0.2, 0, 2*Math.PI);
		  ctx.fill();
	      }
	  }
      }

      function mark_correct(step) {
	  $("#step"+step+"-grade").html('<div class="check">&#x2713;</div>');
	  $(".ans"+step).prop('readonly', true);
	  $(".ans"+step).css("background-color", "white");
	  $(".ans"+step).unbind("change");
      }

      function mark_wrong(step) {
	  $("#step"+step+"-grade").html('<div class="cross">&#x2718;</div>');
	  $(".ans"+step).css("background-color", "pink");
      }

      function check_step1a() {
	  var z1 = $("#ans1a-a").val();
	  var m1 = $("#ans1a-b").val();

	  if (z1 == '' || m1 == '') {
	      $(".ans1a").css("background-color", "white");
	      return;
	  }
	  
	  z1 = Number(z1);
	  m1 = Number(m1);
	  
	  if (z1 in the_polynomial.zeros && the_polynomial.zeros[z1] === m1) {
	      mark_correct('1a');
	      show_step1b();
	  } else {
	      mark_wrong('1a');
	  }
      }

      function check_step1b() {
	  var z2 = $("#ans1b-a").val();
	  var m2 = $("#ans1b-b").val();

	  if (z2 == '' || m2 == '') {
	      $(".ans1a").css("background-color", "white");
	      return;
	  }
	  
	  var z1 = Number($("#ans1a-a").val());
	  z2 = Number(z2);
	  m2 = Number(m2);
	  
	  if (z1 !== z2 && z2 in the_polynomial.zeros && the_polynomial.zeros[z2] === m2) {
	      mark_correct('1b');
	      show_step1c();
	  } else {
	      mark_wrong('1b');
	  }
      }

      function check_step1c() {
	  var z3 = $("#ans1c-a").val();
	  var m3 = $("#ans1c-b").val();

	  if (z3 == '' || m3 == '') {
	      $(".ans1a").css("background-color", "white");
	      return;
	  }
	  
	  var z1 = Number($("#ans1a-a").val());
	  var z2 = Number($("#ans1b-a").val());
	  z3 = Number(z3);
	  m3 = Number(m3);
	  
	  if (z3 !== z1 && z3 !== z2 && z3 in the_polynomial.zeros && the_polynomial.zeros[z3] === m3) {
	      mark_correct('1c');
	      show_step2();
	  } else {
	      mark_wrong('1c');
	  }
      }

      function check_step2() {
	  var ans_f1 = $("#ans2-a").val();
	  var ans_e1 = $("#ans2-b").val();
	  var ans_f2 = $("#ans2-c").val();
	  var ans_e2 = $("#ans2-d").val();
	  var ans_f3 = $("#ans2-e").val();
	  var ans_e3 = $("#ans2-f").val();

	  if (ans_f1 == '' || ans_f2 == '' || ans_f3 == '' || ans_e1 == '' || ans_e2 == '' || ans_e3 == '') {
	      $(".ans2").css("background-color", "white");
	      return;
	  }

	  var p = the_polynomial;
	  var factors = [ [-p.z1, 1], [-p.z2, 1], [-p.z3, 1] ]
	  var exps = [p.m1, p.m2, p.m3];
	  var matches = [false, false, false];
	  
	  function match_factor(f, e) {
	      for (var i = 0, len = factors.length; i < len; i++) {
		  if (POLY.equals_simplified_polynomial(f, factors[i]) && e == exps[i]) {
		      matches[i] = true;
		  }
	      }
	  }
	  
	  match_factor(ans_f1, Number(ans_e1));
	  match_factor(ans_f2, Number(ans_e2));
	  match_factor(ans_f3, Number(ans_e3));

	  if (matches[0] && matches[1] && matches[2]) {
	      mark_correct('2');
	      show_step3();
	  } else {
	      mark_wrong('2');
	  }
	  
      }

      function show_step1b() {
	  $("#zeros-list").append(
	      '<li> zero at <it>x</it> = <input id="ans1b-a" class="input ans1b" type="text" autocomplete="off" formnovalidate></input>'
		  + ' with a multiplicity of <input id="ans1b-b" class="input ans1b" type="text" autocomplete="off"></input>'
		  + ' <span id="step1b-grade"></span>'
		  + '</li>'
	  );

	  $(".ans1b").change(check_step1b);
	  $("#ans1b-a").focus();
      }

      function show_step1c() {
	  $("#zeros-list").append(
	      '<li> zero at <it>x</it> = <input id="ans1c-a" class="input ans1c" type="text" autocomplete="off" formnovalidate></input>'
		  + ' with a multiplicity of <input id="ans1c-b" class="input ans1c" type="text" autocomplete="off"></input>'
		  + ' <span id="step1c-grade"></span>'
		  + '</li>'
	  );

	  $(".ans1c").change(check_step1c);
	  $("#ans1c-a").focus();
      }

      function show_step2() {
	  $("#walkthrough").append(
	      '<li id="step2" class="step">'
		  + 'Write out the factors and their powers:<br><br>'
		  + '<div class="formula-div"><i>f(x)</i> = <i>a</i>'
		  + '&middot;'
		  + '<big>(</big><input id="ans2-a" class="input ans2" type="text" autocomplete="off" formnovalidate><big>)</big>'
		  + '<sup><input id="ans2-b" class="smallinput ans2" type="text" autocomplete="off" formnovalidate></sup>'
		  + '&middot;'
		  + '<big>(</big><input id="ans2-c" class="input ans2" type="text" autocomplete="off" formnovalidate><big>)</big>'
		  + '<sup><input id="ans2-d" class="smallinput ans2" type="text" autocomplete="off" formnovalidate></sup>'
		  + '&middot;'
		  + '<big>(</big><input id="ans2-e" class="input ans2" type="text" autocomplete="off" formnovalidate><big>)</big>'
		  + '<sup><input id="ans2-f" class="smallinput ans2" type="text" autocomplete="off" formnovalidate></sup>'
		  + ' <span id="step2-grade"></span>'
		  + '</div>'
		  + '</li>'
	  );

	  $(".ans2").change(check_step2);
	  $("#ans2-a").focus();
      }

    </script>
  </head>
  
  <body>
    <div id="graphdiv">
      <canvas class="graph" id="graph1"></canvas>
      <canvas class="graph" id="graph2"></canvas>
    </div>

    <ol id="walkthrough">  
      <li id="step1" class="step">
	List each zero and its multiplicity:<br>
	<ul id="zeros-list" style="list-style-type:disc">
	  <li> zero at <it>x</it> = <input id="ans1a-a" class="input ans1a" type="text" autocomplete="off" formnovalidate></input>
	    with a multiplicity of <input id="ans1a-b" class="input ans1a" type="text" autocomplete="off"></input>
	    <span id="step1a-grade"></span>
	  </li>
	</ul>
      </li>      
    </ol>
      
    <script type="text/javascript">
      $(function() {
	  init_canvas("#graph1");
	  init_canvas("#graph2");
	  draw_grid();
	  the_polynomial = good_random_poly3();
	  graph_function();

	  $(".ans1a").change(check_step1a);
	  $("#ans1a-a").focus();
      });
    </script>

  </body>


</html>
